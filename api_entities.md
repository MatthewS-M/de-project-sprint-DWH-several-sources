Для реализации витрины будут необходимы следующие поля: 

|   |   |   |   |   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|---|---|---|---|
|courier_id|courier_name|settlement_year|settlement_month|orders_count|orders_total_sum|rate_avg|order_processing_fee|courier_order_sum|courier_tip_sum|courier_reward_sum|

Для построения витрины данных с перечисленными выше атрибутами следует изначально извлечь данные из API и выгрузить их в сыром виде в staging слой as-is, то есть они должны оставаться в том же JSON формате. Далее необходимо преобразовать и перенести эти данные в Detailed Data Store, где данные будут уже разбиты на определенные колонки соответствующего типа.
В слое DDS уже находятся следующие нужные для витрины таблицы: `dm_orders`, `dm_timetamps`. Для построения витрины эти сущности надо дополнить (новыми колонками) и добавить новые сущности: `deliveries`, `couriers`. Таблица `dm_restaurants` содержит актуальные данные по все четырем ресторанам (было проверено выгрузкой из API, что новых ресторанов не нашлось), поэтому было принято решение оставить эту таблицу без изменения. 

### DDL запросы для дополнения таблицы `dm_orders`:
```postgresql
alter table dds.dm_orders add column courier_id text references stg.couriers(courier_id);  
update dds.dm_orders ord set courier_id=d.courier_id from stg.deliveries d where d.order_id=ord.order_key;  
  
alter table dds.dm_orders add column order_cost numeric(14,2);  
update dds.dm_orders ord set order_cost=cast(s.object_value::json ->> 'cost' as numeric(14,2)) from stg.ordersystem_orders as s where s.object_id=ord.order_key;
```
Новые таблицы в слое DDS, необходимые для заполнения витрины: `dds.couriers`,`dds.deliveries`. Данные в нее переносятся из staging слоя соответствующих сущностей. Происходит извлечение каждого ключа в качестве наименования атрибута и присвоение ему значения из формата JSON.

### Графическое представление ETL-процесса
![image](https://github.com/MatthewS-M/de-project-sprint-5/assets/117388645/38180d6f-0322-4bc2-b3da-715501d20fdd)

### Наполнение витрины `cdm.dm_courier_ledger`
| id | courier\_id | courier\_name | settlement\_year | settlement\_month | orders\_count | orders\_total\_sum | rate\_avg | order\_processing\_fee | courier\_order\_sum | courier\_tips\_sum | courier\_reward\_sum |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 201 | 0aevuwjtk3ubqt542prpj4h | Анна Орлова | 2023 | 10 | 11 | 50770.00 | 5.00 | 12692.50 | 12651.20 | 7615.00 | 19885.45 |
| 202 | 0dvhy72rx6h2xg1zzbq05l8 | Сергей Кузнецов | 2023 | 10 | 10 | 63073.00 | 5.00 | 15768.25 | 12612.60 | 9459.00 | 21598.65 |
| 203 | 0ecq6krzkjw0qom9qoln95n | Сергей Михайлов | 2023 | 10 | 6 | 37590.00 | 5.00 | 9397.50 | 9441.60 | 1878.00 | 11225.70 |
| 204 | 0gmueulyj8m9et38qbu0jsu | Эдуард Новиков | 2023 | 10 | 11 | 57951.00 | 5.00 | 14487.75 | 10012.90 | 5794.00 | 15517.20 |
| 205 | 0m3wp27cgdtl4gbuzau78aw | Геннадий Михайлов | 2023 | 10 | 5 | 12448.00 | 5.00 | 3112.00 | 6961.40 | 622.00 | 7552.30 |
| 206 | 1042ztwbsa7nsu5sajb5nhk | Олег Смирнов | 2023 | 10 | 10 | 61833.00 | 5.00 | 15458.25 | 14483.40 | 3089.00 | 17417.95 |
| 207 | 141da0vcgc4kem2tdyyqgrt | Александр Новиков | 2023 | 10 | 9 | 58544.00 | 5.00 | 14636.00 | 9464.60 | 2925.00 | 12243.35 |
| 208 | 1u5q35dic4vibnqx83bm3y3 | Александра Лебедева | 2023 | 10 | 8 | 49812.00 | 5.00 | 12453.00 | 13395.30 | 4980.00 | 18126.30 |
| 209 | 1xyrc0b9540oygiamtj97pf | Снежанна Великая | 2023 | 10 | 5 | 12340.00 | 5.00 | 3085.00 | 4282.00 | 1234.00 | 5454.30 |
| 210 | 2barvul8jk7tuhcr6s6s24b | Иван Попов | 2023 | 10 | 3 | 23339.00 | 5.00 | 5834.75 | 4347.90 | 2333.00 | 6564.25 |
| 211 | 2tu8acj7ucibrr4cbael1zr | Светлана Морозова | 2023 | 10 | 6 | 55257.00 | 5.00 | 13814.25 | 10106.60 | 5525.00 | 15355.35 |
| 212 | 2vcykv0yd2t8zymn54kgkle | Алексей Попов | 2023 | 10 | 16 | 59434.00 | 5.00 | 14858.50 | 9985.50 | 8913.00 | 18452.85 |
| 213 | 3b9khln79htfvnmn8x92l1j | Петр Соколов | 2023 | 10 | 13 | 53035.00 | 5.00 | 13258.75 | 12105.80 | 5302.00 | 17142.70 |
| 214 | 3elyw8mhm90zji01qub6zhz | Евгений Кузнецов | 2023 | 10 | 9 | 36823.00 | 5.00 | 9205.75 | 9326.40 | 5521.00 | 14571.35 |
| 215 | 3p03gzuioy0z713ufuc119k | Елизавета Волкова | 2023 | 10 | 18 | 70000.00 | 5.00 | 17500.00 | 11967.00 | 10496.00 | 21938.20 |
| 216 | 42bwhz7et0j0b0bzrv5ufo6 | Екатерина Орлова | 2023 | 10 | 10 | 53494.00 | 5.00 | 13373.50 | 9597.90 | 2672.00 | 12136.30 |
| 217 | 45trng2rrwgkqzgyf4hleuq | Надежда Орлова | 2023 | 10 | 8 | 45600.00 | 5.00 | 11400.00 | 10703.60 | 2279.00 | 12868.65 |
| 218 | 49dvbei0zsx7ftfvhj8i9k1 | Иван Петров | 2023 | 10 | 8 | 52812.00 | 5.00 | 13203.00 | 8847.70 | 5281.00 | 13864.65 |
| 219 | 4gbad0p13isol4zi51rn097 | Александра Козлова | 2023 | 10 | 5 | 29560.00 | 5.00 | 7390.00 | 7269.00 | 1478.00 | 8673.10 |
| 220 | 6y3lon1906q4qi5dl65n1sn | Евгения Великая | 2023 | 10 | 10 | 44706.00 | 5.00 | 11176.50 | 7229.10 | 2233.00 | 9350.45 |
| 221 | 6zeale438szmzzhkrhsreqe | Сергей Попов | 2023 | 10 | 6 | 25080.00 | 5.00 | 6270.00 | 5936.40 | 1253.00 | 7126.75 |
| 222 | 7cqihu53a1klcuy328n56s5 | Эдуард Попов | 2023 | 10 | 8 | 46100.00 | 5.00 | 11525.00 | 9444.40 | 4610.00 | 13823.90 |
| 223 | 802fsnarcypl6y8mxrbwu9d | Александр Сидоров | 2023 | 10 | 4 | 22920.00 | 4.00 | 5730.00 | 4931.29 | 3436.00 | 8195.49 |
| 224 | 8lgisq1294zv2wymh64vk3b | Оксана Морозова | 2023 | 10 | 8 | 47890.00 | 5.00 | 11972.50 | 10424.80 | 2393.00 | 12698.15 |
| 225 | 9mmh089jsu0ytmzchrdmy2k | Иван Попов | 2023 | 10 | 4 | 19310.00 | 5.00 | 4827.50 | 7956.50 | 965.00 | 8873.25 |
| 226 | ahnsg14ih09pp8hccdixp4d | Анна Козлова | 2023 | 10 | 6 | 19060.00 | 5.00 | 4765.00 | 5790.40 | 1906.00 | 7601.10 |
| 227 | aiei46vzvbgaygjw4vcljd4 | Александр Иванов | 2023 | 10 | 11 | 53638.00 | 5.00 | 13409.50 | 11099.20 | 2679.00 | 13644.25 |
| 228 | b5he0l8l6pyqxtwt3iyjjt0 | Екатерина Лебедева | 2023 | 10 | 11 | 45940.00 | 5.00 | 11485.00 | 9378.30 | 6890.00 | 15923.80 |
| 229 | b9c4ba9zwrjmfla0t6rzoi4 | Константин Кузнецов | 2023 | 10 | 12 | 53856.00 | 5.00 | 13464.00 | 10108.80 | 5385.00 | 15224.55 |
| 230 | bfwlei1oe250j74c0lsckl6 | Елизавета Великая | 2023 | 10 | 7 | 43124.00 | 5.00 | 10781.00 | 8711.10 | 6468.00 | 14855.70 |
| 231 | bjin7wi4ylfb3q1d8dyprn9 | Александр Михайлов | 2023 | 10 | 13 | 98969.00 | 5.00 | 24742.25 | 15135.50 | 4945.00 | 19833.25 |
| 232 | bw197zb69f7fkahgf41ec8x | Петр Новиков | 2023 | 10 | 16 | 82623.00 | 5.00 | 20655.75 | 17259.70 | 8261.00 | 25107.65 |
| 233 | bzl69i4onygzapx6zmu2swt | Иван Иванов | 2023 | 10 | 10 | 57015.00 | 5.00 | 14253.75 | 9530.80 | 2848.00 | 12236.40 |
| 234 | c6njjhjxwnq9aqm213erzrt | Петр Сидоров | 2023 | 10 | 14 | 74911.00 | 5.00 | 18727.75 | 8862.10 | 11233.00 | 19533.45 |
| 235 | ck8ek7ka9x0bxyinahwytpt | Олег Попов | 2023 | 10 | 17 | 95893.00 | 5.00 | 23973.25 | 13215.30 | 14380.00 | 26876.30 |
| 236 | d5phtik1ohoiulg4n9h8n1w | Надежда Павлова | 2023 | 10 | 7 | 37991.00 | 5.00 | 9497.75 | 7008.80 | 3799.00 | 10617.85 |
| 237 | daovljdtylfw6qjx20yonms | Евгений Соколов | 2023 | 10 | 12 | 58752.00 | 5.00 | 14688.00 | 12448.10 | 5874.00 | 18028.40 |
| 238 | dbfai8nmj6ar839tlmcpx16 | Константин Васильев | 2023 | 10 | 11 | 60815.00 | 5.00 | 15203.75 | 10519.50 | 9118.00 | 19181.60 |
| 239 | e49rvdt4dmypkoq5lfhyqfh | Екатерина Морозова | 2023 | 10 | 6 | 34180.00 | 5.00 | 8545.00 | 9772.50 | 5125.00 | 14641.25 |
| 240 | eopbazd55yw4r1im9neyl4a | Алексей Сидоров | 2023 | 10 | 7 | 31939.00 | 5.00 | 7984.75 | 8956.90 | 3193.00 | 11990.25 |
| 241 | esz7ps9obiigwjl4xztxf0t | Сергей Смирнов | 2023 | 10 | 8 | 63892.00 | 5.00 | 15973.00 | 11252.60 | 6387.00 | 17320.25 |
| 242 | fpnea1l5xlk2hp37sw9jxsi | Эдуард Попов | 2023 | 10 | 14 | 79639.00 | 4.00 | 19909.75 | 7073.43 | 11942.00 | 18418.33 |
| 243 | g5v8jh9qwoyjuxcgf3wpemn | Алексей Соколов | 2023 | 10 | 6 | 20940.00 | 5.00 | 5235.00 | 10222.80 | 2094.00 | 12212.10 |
| 244 | gf0cjp3v0ewjua7tocoqjdt | Александр Михайлов | 2023 | 10 | 12 | 66199.00 | 5.00 | 16549.75 | 12988.70 | 3307.00 | 16130.35 |
| 245 | gooedqylbsk5whtq9nucyd2 | Петр Новиков | 2023 | 10 | 10 | 42825.00 | 5.00 | 10706.25 | 11001.90 | 2138.00 | 13033.00 |
| 246 | gs7xylzkyih2kwda16cju57 | Евгения Великая | 2023 | 10 | 16 | 105632.00 | 5.00 | 26408.00 | 16829.50 | 5277.00 | 21842.65 |
| 247 | gx1s1pt2aojz8mshk45kgcl | Алексей Иванов | 2023 | 10 | 10 | 48316.00 | 5.00 | 12079.00 | 11909.90 | 2414.00 | 14203.20 |
| 248 | gy0wtaazajy10610rzf9n3d | Елизавета Козлова | 2023 | 10 | 9 | 44057.00 | 4.00 | 11014.25 | 9624.51 | 4192.00 | 13606.91 |
| 249 | h4evgnqcjtihl0smn8lf3be | Евгения Великая | 2023 | 10 | 7 | 26217.00 | 5.00 | 6554.25 | 6135.70 | 3931.00 | 9870.15 |
| 250 | hpwwv2mcb1sbdhhcxreug3a | Снежанна Морозова | 2023 | 10 | 13 | 75217.00 | 5.00 | 18804.25 | 13596.70 | 11278.00 | 24310.80 |
| 251 | hxv8ld3pnv7hqx2c3758vsn | Ольга Великая | 2023 | 10 | 7 | 27491.00 | 5.00 | 6872.75 | 5706.40 | 4122.00 | 9622.30 |
| 252 | ihy7xbggj8jmy1p078tp1v0 | Эдуард Кузнецов | 2023 | 10 | 7 | 39908.00 | 4.00 | 9977.00 | 5721.38 | 5984.00 | 11406.18 |
| 253 | ijdqfb2lmf7s8sjtteg1rlu | Алексей Попов | 2023 | 10 | 11 | 82012.00 | 5.00 | 20503.00 | 16683.30 | 12300.00 | 28368.30 |
| 254 | ijv51lqp14ip61p9qhd4pyn | Елизавета Великая | 2023 | 10 | 17 | 79956.00 | 5.00 | 19989.00 | 13120.70 | 7995.00 | 20715.95 |
| 255 | iln0wtl6msbqv291dvh0yw9 | Геннадий Смирнов | 2023 | 10 | 8 | 20887.00 | 5.00 | 5221.75 | 8559.30 | 1044.00 | 9551.10 |
| 256 | j5igs043ymu5mq8ikh2wn8p | Ольга Алексеева | 2023 | 10 | 7 | 27266.00 | 5.00 | 6816.50 | 6649.40 | 1362.00 | 7943.30 |
| 257 | jmj3iqqm4blx0yzu02ndgrq | Сергей Михайлов | 2023 | 10 | 7 | 38042.00 | 5.00 | 9510.50 | 12137.00 | 1901.00 | 13942.95 |
| 258 | ked68h52veoa8e3u92srxhm | Надежда Алексеева | 2023 | 10 | 11 | 58134.00 | 5.00 | 14533.50 | 13454.30 | 8718.00 | 21736.40 |
| 259 | l0kao6sl6xwtm1zejubfpuk | Екатерина Морозова | 2023 | 10 | 5 | 30792.00 | 5.00 | 7698.00 | 6761.60 | 4617.00 | 11147.75 |
| 260 | lalsknnkxyqfuype7joqi3v | Александр Васильев | 2023 | 10 | 10 | 34995.00 | 5.00 | 8748.75 | 6978.20 | 3499.00 | 10302.25 |
| 261 | liftvqrvf4qmhqa95e0zdpl | Сергей Иванов | 2023 | 10 | 12 | 41498.00 | 5.00 | 10374.50 | 8788.30 | 2072.00 | 10756.70 |
| 262 | m79jilii9ztn7gw1xu1fidr | Эдуард Попов | 2023 | 10 | 8 | 45086.00 | 5.00 | 11271.50 | 7808.40 | 6762.00 | 14232.30 |
| 263 | mfmej3w2zpai40w3ve2gsmf | Елизавета Егорова | 2023 | 10 | 14 | 76460.00 | 5.00 | 19115.00 | 9730.40 | 3820.00 | 13359.40 |
| 264 | mzvdr63cb8bwp89o72l0rhn | Анна Лебедева | 2023 | 10 | 11 | 46661.00 | 5.00 | 11665.25 | 8572.00 | 6996.00 | 15218.20 |
| 265 | n2jio5izvlh6njk2rwwdkt9 | Геннадий Васильев | 2023 | 10 | 9 | 34325.00 | 5.00 | 8581.25 | 10415.90 | 5147.00 | 15305.55 |
| 266 | n9b3dpcrawws7e20h6gv7wk | Евгения Федорова | 2023 | 10 | 14 | 75141.00 | 5.00 | 18785.25 | 12872.80 | 3753.00 | 16438.15 |
| 267 | of31dg0monjj1ysiqc5kcwt | Петр Соколов | 2023 | 10 | 13 | 53357.00 | 4.00 | 13339.25 | 4829.79 | 7999.00 | 12428.84 |
| 268 | oovpnp0qq8346mf23z433ay | Эдуард Васильев | 2023 | 10 | 4 | 23830.00 | 5.00 | 5957.50 | 11981.80 | 2382.00 | 14244.70 |
| 269 | ozh1uvvzotocv1lxdive36v | Елизавета Федорова | 2023 | 10 | 7 | 31265.00 | 5.00 | 7816.25 | 9482.30 | 3125.00 | 12451.05 |
| 270 | pbtidx3txhykg828a0j5mxl | Александр Михайлов | 2023 | 10 | 9 | 38625.00 | 4.00 | 9656.25 | 5854.59 | 4458.00 | 10089.69 |
| 271 | pesqpbvb5l2fvy8tl3whfx6 | Светлана Егорова | 2023 | 10 | 13 | 71818.00 | 5.00 | 17954.50 | 10056.80 | 3587.00 | 13464.45 |
| 272 | pp4um2t0mu7qwivdo2hdnqp | Снежанна Орлова | 2023 | 10 | 7 | 31797.00 | 5.00 | 7949.25 | 7808.00 | 1588.00 | 9316.60 |
| 273 | q5s38ujqqa3vuzt47c0fmsh | Константин Васильев | 2023 | 10 | 15 | 81689.00 | 5.00 | 20422.25 | 10384.90 | 4080.00 | 14260.90 |
| 274 | qjkmpbz71n9cuwam0sotk0f | Константин Смирнов | 2023 | 10 | 9 | 48189.00 | 5.00 | 12047.25 | 12426.50 | 2407.00 | 14713.15 |
| 275 | r01siowhwtmorwfj6xkz14d | Сергей Смирнов | 2023 | 10 | 16 | 86569.00 | 5.00 | 21642.25 | 13578.90 | 4324.00 | 17686.70 |
| 276 | r1tcsg32t6vqp7urwzqgy1h | Ольга Орлова | 2023 | 10 | 13 | 88576.00 | 5.00 | 22144.00 | 14053.80 | 13283.00 | 26672.65 |
| 277 | r2lehvxubx9wv1eaxo7oh0q | Александр Соколов | 2023 | 10 | 10 | 54514.00 | 5.00 | 13628.50 | 7372.40 | 5451.00 | 12550.85 |
| 278 | r6oniyq977y1wicn5c79e5u | Геннадий Смирнов | 2023 | 10 | 11 | 61206.00 | 4.00 | 15301.50 | 7731.08 | 9179.00 | 16451.13 |
| 279 | r97ge2qu9f2wkunjoxvwn2c | Снежанна Лебедева | 2023 | 10 | 10 | 57812.00 | 5.00 | 14453.00 | 10208.50 | 5780.00 | 15699.50 |
| 280 | t3o574sug52yslpo9i1am1l | Иван Петров | 2023 | 10 | 9 | 44569.00 | 5.00 | 11142.25 | 11041.40 | 4456.00 | 15274.60 |
| 281 | tuu8pgcwuez6ceimp21vj87 | Снежанна Волкова | 2023 | 10 | 8 | 37345.00 | 5.00 | 9336.25 | 7039.70 | 3734.00 | 10587.00 |
| 282 | u62zl8uanvzp0fg0w78vd1o | Евгений Соколов | 2023 | 10 | 13 | 57450.00 | 4.00 | 14362.50 | 8051.05 | 8614.00 | 16234.35 |
| 283 | ucf55g1l43l6lg4mb8skboi | Светлана Федорова | 2023 | 10 | 7 | 45006.00 | 5.00 | 11251.50 | 9745.90 | 4500.00 | 14020.90 |
| 284 | udcxxw6cfe85uaz5rs52uaj | Светлана Федорова | 2023 | 10 | 12 | 80544.00 | 5.00 | 20136.00 | 13108.40 | 8052.00 | 20757.80 |
| 285 | uq9yadf6ekmchrdqhogao7z | Снежанна Волкова | 2023 | 10 | 11 | 65241.00 | 5.00 | 16310.25 | 9524.30 | 9784.00 | 18819.10 |
| 286 | v3wgbtp6174ixlpwbx7k8xx | Геннадий Смирнов | 2023 | 10 | 10 | 41845.00 | 5.00 | 10461.25 | 9621.20 | 6274.00 | 15581.50 |
| 287 | vh6qk9smyjjlwtrgfl6drnj | Александра Волкова | 2023 | 10 | 11 | 60036.00 | 5.00 | 15009.00 | 12271.20 | 9004.00 | 20825.00 |
| 288 | vw8kc2n01opbfww7s3259nm | Елизавета Козлова | 2023 | 10 | 11 | 75690.00 | 4.00 | 18922.50 | 8564.78 | 8608.00 | 16742.38 |
| 289 | wc8zzefo7qdv0d6qxg0283z | Сергей Иванов | 2023 | 10 | 15 | 96154.00 | 5.00 | 24038.50 | 14645.60 | 14419.00 | 28343.65 |
| 290 | wel9e2xrmcnfqy7w5mx6z3k | Анна Козлова | 2023 | 10 | 12 | 61979.00 | 5.00 | 15494.75 | 11113.20 | 6195.00 | 16998.45 |
| 291 | wujljomac8uidb5hjtz7i4e | Геннадий Петров | 2023 | 10 | 14 | 80491.00 | 5.00 | 20122.75 | 9255.10 | 12070.00 | 20721.60 |
| 292 | wzlidrk2qp4d9nk9424sa3n | Светлана Морозова | 2023 | 10 | 10 | 44028.00 | 5.00 | 11007.00 | 5427.80 | 4402.00 | 9609.70 |
| 293 | xe1qqe7ncx2dkgd9r2zydiw | Елизавета Федорова | 2023 | 10 | 7 | 38360.00 | 5.00 | 9590.00 | 12435.30 | 3835.00 | 16078.55 |
| 294 | y8wxm57g697v3nluul26brd | Сергей Васильев | 2023 | 10 | 8 | 44028.00 | 5.00 | 11007.00 | 7054.00 | 4402.00 | 11235.90 |
| 295 | z5j35stiasug1c9qgul37k5 | Александра Егорова | 2023 | 10 | 6 | 37980.00 | 5.00 | 9495.00 | 7916.60 | 3798.00 | 11524.70 |
| 296 | z5mgd3ytzirkjwyoiq2lc7h | Оксана Орлова | 2023 | 10 | 6 | 27180.00 | 5.00 | 6795.00 | 8801.30 | 1358.00 | 10091.40 |
| 297 | z8n4zci0tt0ph9hnoadzwpo | Петр Новиков | 2023 | 10 | 9 | 38420.00 | 3.00 | 9605.00 | 5115.75 | 3342.00 | 8290.65 |
| 298 | zk7dvufdfqle7ivk7ccurgd | Александр Смирнов | 2023 | 10 | 11 | 64080.00 | 5.00 | 16020.00 | 10867.70 | 3202.00 | 13909.60 |
| 299 | zs30wc2fd40s92fbwjs4r0q | Александр Васильев | 2023 | 10 | 12 | 49199.00 | 5.00 | 12299.75 | 10468.70 | 4919.00 | 15141.75 |
| 300 | ztzzwmyiutjb3ud69utmj2p | Иван Смирнов | 2023 | 10 | 15 | 87368.00 | 5.00 | 21842.00 | 14491.80 | 4364.00 | 18637.60 |
